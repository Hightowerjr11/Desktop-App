stages:
  - Build Dependencies
  - Build
  - Artifact Upload

#before_script:
#  - sample

variables:
  CODE_SIGNING_PFX_PATH: 'installer\windows\signing\code_signing.pfx'

#cache:
#  key: sample
#  paths:
#    - sample_path

#hello_world:
#  tags: [win10]
#  stage: Build Dependencies
#  script:
#    - echo hello.world
#    - .\test.ps1
#    - .\install_curl.bat
#  rules:
#    - if: $CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_BRANC
#      changes:
#        - some-file

build:
  tags: [win10]
  stage: Build
  before_script:
    - & {$outpath = ('$CODE_SIGNING_PFX_PATH'); $inpath = ('$CODE_SIGNING_PFX_BASE64'); [IO.File]::WriteAllBytes($outpath, ([convert]::FromBase64String(([IO.File]::ReadAllText($inpath)))))}
  script:
    - cd installer\windows
    - .\build_all.bat
